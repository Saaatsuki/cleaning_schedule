<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main</title>
    <link rel="stylesheet" href="../../components/header.css">
    <link rel="stylesheet" href="../../components/menu.css">
    <link rel="stylesheet" href="main.css">
    <script src="../../components/header.js"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>

</head>
<body>
    <main>
        <div class="main-menu">
            <div class="panda">
<!-- 
                    <div class="weather-container">
                        <div class="weather-card" id="message">

                        </div>
                    </div> -->

                <div class="panda_v">
                    <dotlottie-player src="https://lottie.host/c7c2e3c2-8d84-4515-b70e-310adc867ffb/GdW4WDj1xE.lottie" background="transparent" speed="1" style="width: 200px; height: 200px" loop autoplay></dotlottie-player>
                </div>
            </div>
            <div class="button-container">
                <button class="action-button clean" data-link="../clean/clean.html"><img width="60" height="60" src="https://img.icons8.com/ios/100/FFFFFF/housekeeping.png" alt="housekeeping"/>ì²­ì†Œ ì¼ì •</button>
            </div>
        </div>
    </main>
    <script>
        document.querySelector('.action-button.clean').addEventListener('click', function() {
            const link = this.getAttribute('data-link');
            window.location.href = link;
        });

        // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸéš›ã«å¤©æ°—æƒ…å ±ã‚’æ›´æ–°
        window.onload = updateMessage;

        async function updateMessage() {
            const today = new Date();
            const dateStr = today.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
            const weekStr = today.toLocaleDateString('ko-KR', { weekday: 'long' });

            const apiKey = 'f445506b5dd4c08fe74777837d3bbb80'; 
            const city = 'Daegu'; 
            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&lang=kr&units=metric`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                const currentWeather = data.list[0].weather[0].description;
                const currentTemp = data.list[0].main.temp;
                const currentMaxTemp = data.list[0].main.temp_max;
                const currentMinTemp = data.list[0].main.temp_min;

                const tomorrowWeather = data.list[8].weather[0].description;
                const tomorrowMaxTemp = data.list[8].main.temp_max;
                const tomorrowMinTemp = data.list[8].main.temp_min;

                const dayAfterTomorrowWeather = data.list[16].weather[0].description;
                const dayAfterTomorrowMaxTemp = data.list[16].main.temp_max;
                const dayAfterTomorrowMinTemp = data.list[16].main.temp_min;

                const weatherEmojis = {
                    'clear sky': '<img src="../../../img/wether/clear_sky.gif" />',
                    'few clouds': '<img src="../../../img/wether/scattered clouds.gif" />',
                    'scattered clouds': '<img src="../../../img/wether/scattered clouds.gif" />',
                    'broken clouds': 'â˜ï¸',
                    'shower rain': 'ğŸŒ§ï¸',
                    'rain': 'ğŸŒ§ï¸',
                    'thunderstorm': 'â›ˆï¸',
                    'snow': 'â„ï¸',
                    'mist': 'ğŸŒ«ï¸',
                };

                const currentWeatherEmoji = weatherEmojis[currentWeather] || 'ğŸŒ¥ï¸';
                const tomorrowWeatherEmoji = weatherEmojis[tomorrowWeather] || 'ğŸŒ¥ï¸';
                const dayAfterTomorrowWeatherEmoji = weatherEmojis[dayAfterTomorrowWeather] || 'ğŸŒ¥ï¸';

                let clothingAdvice = '';
                if (currentTemp > 25) {
                    clothingAdvice = '<img width="96" height="96" src="https://img.icons8.com/color/96/t-shirt.png" alt="t-shirt"/>';
                } else if (currentTemp > 15) {
                    clothingAdvice = '<img width="96" height="96" src="https://img.icons8.com/color/96/tracksuit.png" alt="tracksuit"/>';
                } else {
                    clothingAdvice = '<img width="20" height="20" src="https://img.icons8.com/color/96/puffer-jacket.png" alt="puffer-jacket"/>';
                }

                document.getElementById('message').innerHTML = `
                    <p class="date">${dateStr} (${weekStr})</p>
                    <p class="current-weather">
                        <span class="weather-icon">${currentWeatherEmoji}</span> ${currentWeather} (í˜„ì¬ ê¸°ì˜¨: ${currentTemp}Â°C)
                    </p>
                    <p class="temp-info">ìµœê³  ê¸°ì˜¨: ${currentMaxTemp}Â°C / ìµœì € ê¸°ì˜¨: ${currentMinTemp}Â°C</p>
                    <p class="clothing-advice">ë³µì¥ ì¶”ì²œ: ${clothingAdvice}</p>
                    <p class="weather-forecast">
                        <span>ë‚´ì¼ ë‚ ì”¨:</span> ${tomorrowWeatherEmoji} ${tomorrowWeather} (ìµœê³  ê¸°ì˜¨: ${tomorrowMaxTemp}Â°C / ìµœì € ê¸°ì˜¨: ${tomorrowMinTemp}Â°C)
                        <span>ëª¨ë ˆ ë‚ ì”¨:</span> ${dayAfterTomorrowWeatherEmoji} ${dayAfterTomorrowWeather} (ìµœê³  ê¸°ì˜¨: ${dayAfterTomorrowMaxTemp}Â°C / ìµœì € ê¸°ì˜¨: ${dayAfterTomorrowMinTemp}Â°C)
                    </p>
                `;
            } catch (error) {
                console.error('ì²œê¸° ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', error);
                document.getElementById('message').innerHTML = `
                    <p class="date">${dateStr} (${weekStr})</p>
                    <p>ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                `;
            }
        }
    </script>
</body>
</html>